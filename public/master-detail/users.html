<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Users</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/duice/dist/duice.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/duice-pagination/dist/duice-pagination.js"></script>
    <style>
        html {
            font-size: 75%;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        main {
            width: 1000px;
            display: grid;
            grid-template-areas:
                'master detail';
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto;
            gap: 1rem;
        }
        .master {
            grid-area: master;
        }
        .detail {
            grid-area: detail;
        }
        .icon--32 {
            height: 32px;
        }
        .icon--64 {
            height: 64px;
        }
    </style>
    <script>
        const _apiUrl = 'https://my-json-server.typicode.com/oopscraft/duice-example';
        const userSearch = new duice.ObjectProxy({
            name: null,
            status: null,
            admin: null,
            _limit: 5,
            _page: 1
        });
        const users = new duice.ArrayProxy([]);
        const user = new duice.ObjectProxy({});

        function getUsers(page) {
            userSearch._page = page || 1;
            let url = new URL(`${_apiUrl}/users`);
            userSearch.name && url.searchParams.append('name_like', userSearch.name);
            userSearch.status && url.searchParams.append('status', userSearch.status);
            userSearch.admin && url.searchParams.append('admin', userSearch.admin);
            url.searchParams.append('_limit', userSearch._limit);
            url.searchParams.append('_page', userSearch._page);
            fetch(url)
            .then(response => response.json())
            .then(data => {
                duice.ArrayProxy.assign(users, data);
            });
        }

        function resetUsers() {
            duice.ObjectProxy.reset(userSearch);
            getUsers();
        }

        function getUser(id) {
            let url = new URL(`${_apiUrl}/users/${id}`);
            fetch(url)
            .then(response => response.json())
            .then(data => {
                duice.ObjectProxy.assign(user, data);
            });
        }

        function createUser() {
            duice.ObjectProxy.clear();
            duice.ObjectProxy.assign(user, {
                _new: true
            });
        }

        function saveUser() {
            if (user._new) {

            } else {

            }
        }

        function deleteUser() {

        }

        document.addEventListener('DOMContentLoaded', () => {
            getUsers();
        });
    </script>
</head>
<body>

<main>
    <div class="master d-flex flex-column gap-1">
        <h2>Master</h2>
        <form onsubmit="return false;" class="d-flex justify-content-between">
            <div class="d-flex gap-1">
                <div>
                    <input type="text" data-duice-bind="userSearch" data-duice-property="name" class="form-control" placeholder="Name" aria-label="Name">
                </div>
                <div>
                    <select data-duice-bind="userSearch" data-duice-property="status" class="form-select">
                        <option value="">Status...</option>
                        <option value="ACTIVE">ACTIVE</option>
                        <option value="LOCKED">LOCKED</option>
                    </select>
                </div>
                <div class="d-flex align-items-center">
                    <label class="form-check-label">
                        <input type="checkbox" data-duice-bind="userSearch" data-duice-property="admin" class="form-check-input">
                        Admin
                    </label>
                </div>
            </div>
            <div class="d-flex gap-1 justify-content-end">
                <button type="submit" onclick="getUsers(1);" class="btn btn-primary">Search</button>
                <button type="button" onclick="resetUsers();" class="btn btn-secondary">Reset</button>
            </div>
        </form>
        <table class="table table-bordered table-hover">
            <thead>
            <tr>
                <th>No</th>
                <th>Username</th>
                <th>Name</th>
                <th class="text-center">Status</th>
                <th class="text-center">Admin</th>
            </tr>
            </thead>
            <tbody>
            <tr style="cursor:pointer;"
                data-duice-bind="users"
                data-duice-loop="user,status"
                data-duice-execute="this.dataset.id=user.id;"
                onclick="getUser(this.dataset.id);">
                <td data-duice-bind="status"
                    data-duice-property="count"
                    class="text-center"></td>
                <td>
                    <img src="/static/image/icon-photo.png" alt="" class="icon--32"
                         data-duice-bind="user"
                         data-duice-property="photo"/>
                    <span data-duice-bind="user"
                          data-duice-property="username"></span>
                </td>
                <td data-duice-bind="user"
                    data-duice-property="name"></td>
                <td class="text-center">
                    <span data-duice-bind="user"
                          data-duice-property="status"
                          class="badge bg-secondary"></span>
                </td>
                <td class="text-center">
                    <input type="checkbox"
                           data-duice-bind="user"
                           data-duice-property="admin"/>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="d-flex justify-content-center">
            <ul class="pagination">
                <li class="page-item"><a class="page-link" href="#" onclick="getUsers(userSearch._page-1);">Previous</a></li>
                <li class="page-item"><a class="page-link" href="#" data-duice-bind="userSearch" data-duice-property="_page"></a></li>
                <li class="page-item"><a class="page-link" href="#" onclick="getUsers(userSearch._page+1);">Next</a></li>
            </ul>
        </div>
    </div>
    <div class="detail">
        <h2>Detail</h2>
        <form class="container border p-4">
            <div class="row py-2">
                <div class="col">
                    <label class="w-100">
                        <span>Username</span>
                        <input type="email" class="form-control"
                               data-duice-bind="user"
                               data-duice-property="username">
                    </label>
                </div>
                <div class="col">
                    <label class="w-100">
                        <span>Name</span>
                        <input type="text" class="form-control"
                               data-duice-bind="user"
                               data-duice-property="name">
                    </label>
                </div>
            </div>
            <div class="row py-2">
                <div class="col">
                    <label class="w-100">
                        <span>Status</span>
                        <select class="form-select"
                                data-duice-bind="user"
                                data-duice-property="status">
                            <option selected>Status...</option>
                            <option value="ACTIVE">ACTIVE</option>
                            <option value="LOCKED">LOCKED</option>
                        </select>
                    </label>
                </div>
                <div class="col align-self-end">
                    <label class="w-100">
                        <input type="checkbox" class="form-checkbox-input"
                               data-duice-bind="user"
                               data-duice-property="admin">
                        <span>Admin</span>
                    </label>
                </div>
            </div>
            <div class="row py-2">
                <div class="col">
                    <label class="w-100">
                        <span>Photo</span><br/>
                        <img src="/static/image/icon-photo.png" alt="" class="icon--64"
                             data-duice-bind="user"
                             data-duice-property="photo"
                             data-duice-editable="true"/>
                    </label>
                </div>
            </div>
            <div class="row py-2">
                <div class="col">
                    <label class="w-100">
                        Profile
                        <textarea class="form-control"></textarea>
                    </label>
                </div>
            </div>
        </form>
    </div>
</main>



</body>
</html>