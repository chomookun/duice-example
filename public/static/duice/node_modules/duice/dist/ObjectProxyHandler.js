import { ProxyHandler } from "./ProxyHandler";
import { ObjectElement } from "./ObjectElement";
import { PropertyChangeEvent } from "./event/PropertyChangeEvent";
/**
 * Object Proxy Handler
 */
export class ObjectProxyHandler extends ProxyHandler {
    /**
     * Constructor
     */
    constructor() {
        super();
    }
    /**
     * Gets target property value
     * @param target target
     * @param property property
     * @param receiver receiver
     */
    get(target, property, receiver) {
        return Reflect.get(target, property, receiver);
    }
    /**
     * Sets target property value
     * @param target
     * @param property
     * @param value
     */
    set(target, property, value) {
        // change value
        Reflect.set(target, property, value);
        // notify
        let event = new PropertyChangeEvent(this, property, value);
        this.notifyObservers(event);
        // returns
        return true;
    }
    /**
     * Updates
     * @param observable observable
     * @param event event
     */
    update(observable, event) {
        // element
        if (observable instanceof ObjectElement) {
            let property = observable.getProperty();
            let value = observable.getValue();
            if (this.checkListener(this.propertyChangingListener, event)) {
                this.setValue(property, value);
                this.checkListener(this.propertyChangedListener, event);
            }
        }
        // notify
        this.notifyObservers(event);
    }
    /**
     * Gets specified property value
     * @param property property
     */
    getValue(property) {
        property = property.replace('.', '?.');
        return new Function(`return this.${property};`).call(this.getTarget());
    }
    /**
     * Sets specified property value
     * @param property property
     * @param value value
     */
    setValue(property, value) {
        new Function('value', `this.${property} = value;`).call(this.getTarget(), value);
    }
    /**
     * Sets focus on property element
     * @param property
     */
    focus(property) {
        this.observers.forEach(observer => {
            if (observer instanceof ObjectElement) {
                if (observer.getProperty() === property) {
                    if (observer.focus()) {
                        return false;
                    }
                }
            }
        });
    }
}
//# sourceMappingURL=ObjectProxyHandler.js.map